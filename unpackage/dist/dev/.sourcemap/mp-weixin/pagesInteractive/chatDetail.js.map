{"version":3,"sources":["uni-app:///main.js","webpack:///E:/uni-app/cfkj/cub-space-mini/pagesInteractive/chatDetail.vue?ed7a","webpack:///E:/uni-app/cfkj/cub-space-mini/pagesInteractive/chatDetail.vue?fbe6","webpack:///E:/uni-app/cfkj/cub-space-mini/pagesInteractive/chatDetail.vue?a2ff","webpack:///E:/uni-app/cfkj/cub-space-mini/pagesInteractive/chatDetail.vue?985d","uni-app:///pagesInteractive/chatDetail.vue","webpack:///E:/uni-app/cfkj/cub-space-mini/pagesInteractive/chatDetail.vue?57f0","webpack:///E:/uni-app/cfkj/cub-space-mini/pagesInteractive/chatDetail.vue?8a08"],"names":["createPage","Page"],"mappings":"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ACA,KAjGA;AAkGA,uBAlGA,+BAkGA,OAlGA,EAkGA;AACA;AACA;AACA;AACA;AACA,UADA,CACA;AACA;AACA;AACA;AACA,OALA;AAMA,WANA,CAMA;AACA;AACA;AACA,gCADA;AAEA,wBAFA;;AAIA;AACA,OAbA;AAcA,KApHA;AAqHA;AACA,oBAtHA,4BAsHA,OAtHA,EAsHA;AACA;AACA;AACA;AACA,UADA,CACA;AACA;AACA;AACA,OAJA;AAKA,WALA,CAKA;AACA;AACA;AACA,OARA;AASA,KAlIA;AAmIA,sBAnIA,8BAmIA,OAnIA,EAmIA;AACA;AACA;AACA;AACA,iDADA;;AAGA,SAJA,MAIA;AACA;AACA;AACA,OARA;AASA,KA7IA;AA8IA,YA9IA,oBA8IA,IA9IA,EA8IA;AACA;AACA,KAhJA;AAiJA,eAjJA,uBAiJA,IAjJA,EAiJA;AACA;AACA,KAnJA;AAoJA,iBApJA,yBAoJA,GApJA,EAoJA;AACA;AACA,KAtJA,EAtCA;;AA8LA;AACA,UADA,oBACA;AACA;AACA,KAHA;AAIA,aAJA,uBAIA;AACA;AACA,qBADA;AAEA,qBAFA;AAGA,qBAHA;AAIA,qBAJA;AAKA,qBALA;;AAOA;AACA;AACA,KAdA;AAeA,YAfA,sBAeA;AACA;AACA,KAjBA,EA9LA;;AAiNA,QAjNA,kBAiNA,OAjNA,EAiNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAFA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAHA;AAIA,KAPA;AAQA;AACA;AACA;AACA;AACA,sBADA;AAEA,mBAFA;AAGA,iDAHA;;AAKA;AACA;AACA,OATA;AAUA;AACA;AACA;AACA;AACA,KAfA;AAgBA;AACA;AACA;AACA;AACA,KAHA;;AAKA;AACA;AACA;AACA,KAHA;AAIA,GAtQA;AAuQA,UAvQA,sBAuQA;AACA;AACA;AACA,GA1QA,E;;;;;;;;;;;;;ACjNA;AAAA;AAAA;AAAA;AAAiuC,CAAgB,ksCAAG,EAAC,C;;;;;;;;;;;ACArvC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pagesInteractive/chatDetail.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pagesInteractive/chatDetail.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chatDetail.vue?vue&type=template&id=ebbd7a48&scoped=true&\"\nvar renderjs\nimport script from \"./chatDetail.vue?vue&type=script&lang=js&\"\nexport * from \"./chatDetail.vue?vue&type=script&lang=js&\"\nimport style0 from \"./chatDetail.vue?vue&type=style&index=0&id=ebbd7a48&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"ebbd7a48\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pagesInteractive/chatDetail.vue\"\nexport default component.exports","export * from \"-!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chatDetail.vue?vue&type=template&id=ebbd7a48&scoped=true&\"","var components\ntry {\n  components = {\n    navbar: function() {\n      return import(\n        /* webpackChunkName: \"components/navbar/navbar\" */ \"@/components/navbar/navbar.vue\"\n      )\n    },\n    uAvatar: function() {\n      return import(\n        /* webpackChunkName: \"uview-ui/components/u-avatar/u-avatar\" */ \"@/uview-ui/components/u-avatar/u-avatar.vue\"\n      )\n    },\n    uTag: function() {\n      return import(\n        /* webpackChunkName: \"uview-ui/components/u-tag/u-tag\" */ \"@/uview-ui/components/u-tag/u-tag.vue\"\n      )\n    },\n    textInput: function() {\n      return import(\n        /* webpackChunkName: \"components/textInput/textInput\" */ \"@/components/textInput/textInput.vue\"\n      )\n    },\n    loading: function() {\n      return import(\n        /* webpackChunkName: \"components/loading/loading\" */ \"@/components/loading/loading.vue\"\n      )\n    }\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 =\n    _vm.paddingHeight && !_vm.inputState\n      ? _vm.__map(_vm.emojiName, function(emoji, e_index) {\n          var $orig = _vm.__get_orig(emoji)\n\n          var m0 = _vm.getEmoji(emoji)\n          return {\n            $orig: $orig,\n            m0: m0\n          }\n        })\n      : null\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chatDetail.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chatDetail.vue?vue&type=script&lang=js&\"","<template>\r\n  <view style=\"background-color: #f3f3f3\" @click=\"cancle\">\r\n    <navbar :title=\"pageTitle\"></navbar>\r\n    <scroll-view\r\n      scroll-y=\"true\"\r\n      :scroll-top=\"scrollTop\"\r\n      class=\"Anchor\"\r\n      :upper-threshold=\"pageHeight * 2\"\r\n      @scrolltoupper=\"scrolltoupper\"\r\n      :style=\"{ height: `calc(100vh - ${ViewPart - 20}px)` }\"\r\n      :scroll-with-animation=\"!ifLoaddingShow\"\r\n      :scroll-anchoring=\"true\"\r\n    >\r\n      <view style=\"padding-bottom: 180rpx\" class=\"Anchor\">\r\n        <view class=\"padding\">\r\n          <!-- 顶部出现卡片 -->\r\n          <view\r\n            class=\"padding wmax flex\"\r\n            v-if=\"isCompleted\"\r\n            style=\"height: 340rpx\"\r\n          >\r\n            <view\r\n              class=\"\r\n                flex-sub\r\n                profileCard\r\n                flex flex-direction\r\n                justify-between\r\n                padding\r\n              \"\r\n              :class=\"lbgColor\"\r\n              v-if=\"userInfo\"\r\n              @click=\"enterUserHome(userIdTo)\"\r\n            >\r\n              <view class=\"\">\r\n                <u-avatar\r\n                  :size=\"80\"\r\n                  :src=\"userInfo.avatar || userInfo.avatarUrl\"\r\n                ></u-avatar>\r\n              </view>\r\n              <view class=\"text-white\">\r\n                {{ userInfo.nick || userInfo.nickName }}\r\n              </view>\r\n              <view class=\"text-white\"> 打个招呼吧~ </view>\r\n            </view>\r\n          </view>\r\n        </view>\r\n        <view style=\"background-color: #f5f5f5\"></view>\r\n        <view v-for=\"(item, I_index) in msgList\" :key=\"item.ID\">\r\n          <view\r\n            class=\"isMessage\"\r\n            v-if=\"!item.isRevoked && !item.isDeleted\"\r\n            :class=\"item.from !== userId ? 'isNotSelf' : 'isSelf'\"\r\n          >\r\n            <view\r\n              :class=\"\r\n                item.from !== userId ? 'margin-right-sm' : 'margin-left-sm'\r\n              \"\r\n            >\r\n              <u-avatar\r\n                :size=\"80\"\r\n                :src=\"item.avatar\"\r\n                @click=\"enterUserHome(item.from)\"\r\n              ></u-avatar>\r\n            </view>\r\n            <view\r\n              class=\"messageBlock flex align-center justify-center\"\r\n              :data-backIndex=\"item.random\"\r\n              @touchstart=\"backTargetChangeStart\"\r\n              @touchend=\"backTargetChangeEnd\"\r\n              :style=\"{\r\n                backgroundColor: chatStyle[item.from !== userId ? 0 : 1],\r\n              }\"\r\n            >\r\n              <!-- 文字模式 -->\r\n              <view\r\n                class=\"flex align-end\"\r\n                v-if=\"item.payload.text\"\r\n                style=\"flex-wrap: wrap\"\r\n              >\r\n                <view\r\n                  class=\"\"\r\n                  v-for=\"(msg, m_index) in item.payload.textDom\"\r\n                  :key=\"m_index\"\r\n                  :data-backIndex=\"item.random\"\r\n                >\r\n                  <text v-if=\"msg.name === 'text'\">{{ msg.text }}</text>\r\n                  <image\r\n                    :src=\"msg.src\"\r\n                    mode=\"aspectFill\"\r\n                    v-if=\"msg.name === 'image'\"\r\n                    style=\"\r\n                      width: 40rpx;\r\n                      height: 40rpx;\r\n                      vertical-align: text-bottom;\r\n                    \"\r\n                  >\r\n                  </image>\r\n                </view>\r\n              </view>\r\n              <!-- <text class=\"text-justify\" v-if=\"item.payload.text\">{{item.payload.text}}</text> -->\r\n\r\n              <!-- 图片模式 -->\r\n              <view\r\n                class=\"flex align-center justify-center\"\r\n                v-if=\"item.payload.imageInfoArray\"\r\n              >\r\n                <image\r\n                  :src=\"item.payload.imageInfoArray[2].url\"\r\n                  @click=\"imgPrview(item.payload.imageInfoArray[1].url)\"\r\n                  mode=\"aspectFill\"\r\n                  v-if=\"item.payload.imageInfoArray[2]\"\r\n                  :style=\"{\r\n                    width: item.payload.imageInfoArray[1].width + 'px',\r\n                    height: item.payload.imageInfoArray[1].height + 'px',\r\n                    maxWidth: '400rpx',\r\n                  }\"\r\n                  :data-backIndex=\"item.random\"\r\n                >\r\n                </image>\r\n              </view>\r\n              <!-- 语音模式 -->\r\n              <view\r\n                class=\"flex align-center\"\r\n                v-if=\"item.payload.remoteAudioUrl\"\r\n                :data-backIndex=\"item.random\"\r\n                @click=\"audioPlayHandle(item.payload.url, I_index, $event)\"\r\n              >\r\n                <view\r\n                  class=\"blockDance flex align-center\"\r\n                  :style=\"{ height: '40rpx' }\"\r\n                >\r\n                  <view\r\n                    :class=\"{ animateRuning: I_index === playAudioIndex }\"\r\n                    v-for=\"(item, index) in 4\"\r\n                    :data-backIndex=\"item.random\"\r\n                    :key=\"index\"\r\n                    class=\"blockDance-item\"\r\n                  ></view>\r\n                </view>\r\n                <text class=\"margin-left-xs\" :data-backIndex=\"item.random\">{{\r\n                  (item.payload.second || 0.5) + 's'\r\n                }}</text>\r\n              </view>\r\n              <!-- 消息撤回框 -->\r\n              <view\r\n                class=\"chatNewsBack padding-xs\"\r\n                @click=\"newsBackClickHandle(item)\"\r\n                v-if=\"item.from === userId && newsBackIndex === item.random\"\r\n              >\r\n                撤回消息\r\n              </view>\r\n            </view>\r\n          </view>\r\n          <view\r\n            class=\"flex justify-center align-center\"\r\n            v-if=\"item.isRevoked && !item.isDeleted\"\r\n          >\r\n            <u-tag\r\n              :text=\"`${userId === item.from ? '你' : '对方'}撤回了一条消息`\"\r\n              shape=\"circle\"\r\n              color=\"#909399\"\r\n              bg-color=\"#F5F5F5\"\r\n              border-color=\"#F5F5F5\"\r\n              @click=\"deleteRevokedMsg(item)\"\r\n            />\r\n          </view>\r\n        </view>\r\n        <!-- 上顶框 -->\r\n        <view class=\"\" :style=\"{ height: paddingHeight + 'px' }\"></view>\r\n      </view>\r\n    </scroll-view>\r\n    <!-- 表情框 -->\r\n    <scroll-view\r\n      scroll-y=\"true\"\r\n      class=\"emojiBox bg-white wmax\"\r\n      style=\"height: 300px; width: 100%\"\r\n      v-if=\"paddingHeight && !inputState\"\r\n    >\r\n      <view class=\"flex\" style=\"flex-wrap: wrap\">\r\n        <view\r\n          class=\"emojiItem\"\r\n          v-for=\"(emoji, e_index) in emojiName\"\r\n          :key=\"e_index\"\r\n          @click=\"emojiSelect(emoji)\"\r\n        >\r\n          <view class=\"emojiTtemImg flex align-center justify-center\">\r\n            <image\r\n              :src=\"getEmoji(emoji)\"\r\n              mode=\"aspectFill\"\r\n              style=\"width: 60%; height: 60%\"\r\n            ></image>\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </scroll-view>\r\n    <textInput\r\n      :mode=\"'aboutChat'\"\r\n      :userIdTo=\"userIdTo\"\r\n      :keyBoardFlag=\"keyBoardFlag\"\r\n      :buttonColor=\"chatStyle[0]\"\r\n    ></textInput>\r\n    <loading v-if=\"ifLoaddingShow\"></loading>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { emojiUrl, emojiMap, emojiName, _TextMsgParser } from 'utils/emoji.js';\r\n// 播放\r\nconst innerAudioContext = uni.createInnerAudioContext();\r\nexport default {\r\n  data() {\r\n    return {\r\n      emojiName: emojiName,\r\n      ifLoaddingShow: true,\r\n      ViewPart: this.ViewPart,\r\n      pageHeight: this.windowHeight,\r\n      // 内容\r\n      content: '',\r\n      // 发送图片\r\n      image: '',\r\n      // 请求的会话ID\r\n      requestId: '',\r\n      tim: this.tim,\r\n      // 消息列表\r\n      msgList: [],\r\n      pageTitle: '加载中',\r\n      // 是否请求完全\r\n      isCompleted: false,\r\n      // 下一次请求的数据ID\r\n      nextReqMessageID: '',\r\n      // 顶部高度\r\n      scrollTop: 0,\r\n      // 发送对象\r\n      userIdTo: '',\r\n      // scrollTimmer 防抖\r\n      scrollTimmer: null,\r\n      userInfo: null,\r\n      paddingHeight: 0,\r\n      keyBoardFlag: false,\r\n      recorderManager: null,\r\n      playAudioIndex: -1,\r\n      newsBackIndex: -1,\r\n      newsBackStartTime: undefined,\r\n      newsBackTimmer: null,\r\n      inputState: false,\r\n    };\r\n  },\r\n  methods: {\r\n    getMessageList() {\r\n      if (this.isCompleted || this.scrollTimmer) {\r\n        return;\r\n      }\r\n      // 获取信息过程\r\n      let tim = this.tim;\r\n      let promise = tim.getMessageList({\r\n        conversationID: this.requestId,\r\n        count: 15,\r\n        nextReqMessageID: this.nextReqMessageID,\r\n      });\r\n      promise\r\n        .then((imResponse) => {\r\n          if (\r\n            !!this.nextReqMessageID &&\r\n            this.nextReqMessageID === imResponse.data.nextReqMessageID\r\n          )\r\n            return;\r\n          // 渲染数据\r\n          for (let msg of imResponse.data.messageList) {\r\n            if (msg.payload.text) {\r\n              this.$set(\r\n                msg.payload,\r\n                'textDom',\r\n                this.TextMsgParser(msg.payload.text)\r\n              );\r\n            }\r\n          }\r\n          //\r\n          this.msgList = imResponse.data.messageList.concat(this.msgList); // 消息列表。\r\n          this.nextReqMessageID = imResponse.data.nextReqMessageID; // 用于续拉，分页续拉时需传入该字段。\r\n          this.isCompleted = imResponse.data.isCompleted; // 表示是否已经拉完所有消息。\r\n          if (!this.scrollTop) {\r\n            this.scrollTop = this.msgList.length * 999;\r\n          }\r\n          setTimeout(() => {\r\n            this.ifLoaddingShow = false;\r\n          }, 500);\r\n          this.scrollTimmer = setTimeout(() => {\r\n            this.scrollTimmer = null;\r\n          }, 200);\r\n        })\r\n        .catch((err) => {\r\n          console.log(err);\r\n        });\r\n      this.$forceUpdate();\r\n    },\r\n    scrolltoupper() {\r\n      if (this.scrollTimmer) {\r\n        return;\r\n      }\r\n      this.getMessageList();\r\n    },\r\n    getImgShowStyle(img) {\r\n      return ';' + this.$api.imgHandle.multiImgShow([img]);\r\n    },\r\n    imgPrview(url) {\r\n      if (this.newsBackIndex !== -1) return;\r\n      this.$api.imgHandle.imgPreview(url, [url]);\r\n    },\r\n    enterUserHome(id) {\r\n      this.$api.routerHandle.goto(`/pagesHome/mynews?id=${id}`);\r\n    },\r\n    audioPlayHandle(src, I_index, e) {\r\n      innerAudioContext.stop();\r\n      this.playAudioIndex = I_index;\r\n      this.$forceUpdate();\r\n      innerAudioContext.src = src;\r\n      innerAudioContext.play();\r\n    },\r\n    // 撤回消息更改对象\r\n    backTargetChangeStart(e) {\r\n      this.newsBackStartTime = +new Date();\r\n      this.newsBackTimmer = setTimeout(() => {\r\n        this.newsBackIndex = e.target.dataset.backindex;\r\n        this.$forceUpdate();\r\n      }, 800);\r\n    },\r\n    backTargetChangeEnd(e) {\r\n      if (+new Date() - this.newsBackStartTime < 800) {\r\n        this.newsBackStartTime = undefined;\r\n        this.newsBackIndex = -1;\r\n        clearTimeout(this.newsBackTimmer);\r\n        this.newsBackTimmer = null;\r\n        this.$forceUpdate();\r\n      }\r\n    },\r\n    cancle() {\r\n      if (this.newsBackIndex === -1 || !this.newsBackStartTime) return;\r\n      if (+new Date() - this.newsBackStartTime > 2000) {\r\n        this.newsBackStartTime = undefined;\r\n        this.newsBackIndex = -1;\r\n        clearTimeout(this.newsBackTimmer);\r\n        this.newsBackTimmer = null;\r\n        this.$forceUpdate();\r\n      }\r\n    },\r\n    newsBackClickHandle(message) {\r\n      // 主动撤回消息\r\n      let tim = this.tim;\r\n      let promise = tim.revokeMessage(message);\r\n      promise\r\n        .then((imResponse) => {\r\n          // 消息撤回成功\r\n          this.$set(message, 'isRevoked', true);\r\n          console.log('撤回成功');\r\n        })\r\n        .catch(function (imError) {\r\n          if (imError.code == 20016) {\r\n            return uni.showToast({\r\n              title: '已超过2分钟无法撤回~',\r\n              icon: 'none',\r\n            });\r\n          }\r\n        });\r\n    },\r\n    // 删除撤回提示\r\n    deleteRevokedMsg(message) {\r\n      let tim = this.tim;\r\n      let promise = tim.deleteMessage([message]);\r\n      promise\r\n        .then((imResponse) => {\r\n          // 删除消息成功\r\n          this.$set(message, 'isDeleted', true);\r\n        })\r\n        .catch(function (imError) {\r\n          // 删除消息失败\r\n          console.warn('deleteMessage error:', imError);\r\n        });\r\n    },\r\n    emojicontentRender(content) {\r\n      return content.replace(/\\[([\\S\\s]+?)\\]/g, (name) => {\r\n        if (emojiMap[name]) {\r\n          return `<img src=\"${\r\n            emojiUrl + emojiMap[name]\r\n          }\" class=\"emojiStyle\"></img>`;\r\n        } else {\r\n          return name;\r\n        }\r\n      });\r\n    },\r\n    getEmoji(name) {\r\n      return emojiUrl + emojiMap[name];\r\n    },\r\n    emojiSelect(name) {\r\n      uni.$emit('textInputAddEmoji', name);\r\n    },\r\n    TextMsgParser(msg) {\r\n      return _TextMsgParser(msg);\r\n    },\r\n  },\r\n  computed: {\r\n    userId() {\r\n      return this.$cache.get('userId');\r\n    },\r\n    chatStyle() {\r\n      let colorPair = [\r\n        '#F8D90A, #FFF',\r\n        '#0396FF, #FFF',\r\n        '#EA5455, #FFF',\r\n        '#7360F0, #FFF',\r\n        '#32CCBC, #FFF',\r\n      ];\r\n      let base = this.pageTitle.charCodeAt(0) % 10 >> 1;\r\n      return colorPair[base].split(',');\r\n    },\r\n    lbgColor() {\r\n      return 'lbg-' + ((this.pageTitle.charCodeAt(0) % 10 >> 1) + 1);\r\n    },\r\n  },\r\n  onLoad(options) {\r\n    // 将某会话下所有未读消息已读上报\r\n    let tim = this.tim;\r\n    this.tim.setMessageRead({ conversationID: options.id });\r\n    this.pageTitle = options.nick;\r\n    this.requestId = options.id;\r\n    // 第一次获取消息列表\r\n    this.getMessageList();\r\n    this.userIdTo = options.userIdTo;\r\n    //\r\n    const eventChannel = this.getOpenerEventChannel();\r\n    // 监听acceptDataFromOpenerPage事件，获取上一页面通过eventChannel传送到当前页面的数据\r\n    eventChannel.on('acceptDataFromOpenerPage', (data) => {\r\n      this.userInfo = data.data;\r\n    });\r\n    //\r\n    // 收到消息\r\n    uni.$off('reciveChatMsg');\r\n    uni.$off('keyboardChange');\r\n    uni.$on('keyboardChange', (height, inputState) => {\r\n      this.inputState = inputState;\r\n      this.paddingHeight = height;\r\n      this.$nextTick(() => {\r\n        this.scrollTop += height;\r\n        this.$forceUpdate();\r\n      });\r\n    });\r\n    uni.$on('reciveChatMsg', (data) => {\r\n      data = data.filter((item) => {\r\n        if (item.payload.text) {\r\n          this.$set(\r\n            item.payload,\r\n            'textDom',\r\n            this.TextMsgParser(item.payload.text)\r\n          );\r\n        }\r\n        return item.from === this.userIdTo || item.to === this.userIdTo;\r\n      });\r\n      this.msgList = this.msgList.concat(data);\r\n      this.scrollTop = this.msgList.length * 999;\r\n      this.tim.setMessageRead({ conversationID: options.id });\r\n      this.$forceUpdate();\r\n    });\r\n    // 音频结束\r\n    innerAudioContext.onStop(() => {\r\n      this.playAudioIndex = -1;\r\n      this.$forceUpdate();\r\n    });\r\n\r\n    innerAudioContext.onEnded(() => {\r\n      this.playAudioIndex = -1;\r\n      this.$forceUpdate();\r\n    });\r\n  },\r\n  onUnload() {\r\n    uni.$off('reciveChatMsg');\r\n    innerAudioContext.stop();\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.Anchor {\r\n  overflow-anchor: auto;\r\n}\r\n\r\n.profileCard {\r\n  border-radius: 10rpx;\r\n  box-shadow: 10rpx 10rpx 10rpx rgba($color: #333333, $alpha: 0.1);\r\n}\r\n\r\n.isMessage {\r\n  // 消息\r\n  padding: 30rpx 20rpx;\r\n  display: flex;\r\n  display: flex;\r\n  justify-content: flex-start;\r\n}\r\n\r\n.messageBlock {\r\n  max-width: 450rpx;\r\n  padding: 20rpx;\r\n  // letter-spacing: 0.5rpx;\r\n  min-width: 100rpx;\r\n  border-radius: 10rpx;\r\n}\r\n\r\n.isNotSelf {\r\n  .messageBlock {\r\n    background-color: #0081ff;\r\n    color: #fff;\r\n    box-shadow: 10rpx 10rpx 10rpx rgba($color: #333333, $alpha: 0.1);\r\n  }\r\n}\r\n.isSelf {\r\n  flex-direction: row-reverse;\r\n  justify-self: flex-start;\r\n  position: relative;\r\n  .chatNewsBack {\r\n    position: absolute;\r\n    top: 0;\r\n    right: 0;\r\n    background-color: rgba($color: #000000, $alpha: 0.5);\r\n    color: white;\r\n    transform: translateX(-50%) translateY(-100%);\r\n    border-radius: 10rpx;\r\n  }\r\n  .messageBlock {\r\n    background-color: #d9e4fa;\r\n    color: #000;\r\n  }\r\n}\r\n\r\n.blockDance {\r\n  .blockDance-item {\r\n    width: 8rpx;\r\n    margin-right: 5rpx;\r\n    border-radius: 4rpx;\r\n    animation-duration: 0.3s;\r\n    background-color: #000;\r\n    animation-fill-mode: forwards;\r\n    animation-iteration-count: infinite;\r\n    animation-direction: alternate;\r\n    animation-play-state: paused;\r\n    &:nth-child(1) {\r\n      height: 20rpx;\r\n      animation-name: dance1;\r\n    }\r\n    &:nth-child(2) {\r\n      height: 40rpx;\r\n      animation-name: dance2;\r\n    }\r\n    &:nth-child(3) {\r\n      height: 30rpx;\r\n      animation-name: dance3;\r\n    }\r\n    &:nth-child(4) {\r\n      height: 20rpx;\r\n      animation-name: dance4;\r\n    }\r\n  }\r\n}\r\n\r\n.emojiItem {\r\n  position: relative;\r\n  width: 12.5%;\r\n  height: 0;\r\n  padding-top: 12.5%;\r\n  .emojiTtemImg {\r\n    position: absolute;\r\n    width: 100%;\r\n    height: 100%;\r\n    left: 0;\r\n    top: 0;\r\n  }\r\n}\r\n\r\n.emojiStyle {\r\n  width: 50rpx;\r\n  height: 50rpx;\r\n  vertical-align: text-bottom;\r\n}\r\n\r\n.emojiBox {\r\n  position: fixed;\r\n  bottom: 0;\r\n}\r\n\r\n@keyframes dance1 {\r\n  from {\r\n    height: 20rpx;\r\n  }\r\n  to {\r\n    height: 40rpx;\r\n  }\r\n}\r\n\r\n@keyframes dance2 {\r\n  from {\r\n    height: 40rpx;\r\n  }\r\n  to {\r\n    height: 20rpx;\r\n  }\r\n}\r\n\r\n@keyframes dance3 {\r\n  from {\r\n    height: 30rpx;\r\n  }\r\n\r\n  50% {\r\n    height: 40rpx;\r\n  }\r\n\r\n  to {\r\n    height: 30rpx;\r\n  }\r\n}\r\n\r\n@keyframes dance4 {\r\n  from {\r\n    height: 20rpx;\r\n  }\r\n  to {\r\n    height: 40rpx;\r\n  }\r\n}\r\n\r\n.animateRuning {\r\n  animation-play-state: running !important;\r\n}\r\n</style>\r\n","import mod from \"-!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chatDetail.vue?vue&type=style&index=0&id=ebbd7a48&lang=scss&scoped=true&\"; export default mod; export * from \"-!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chatDetail.vue?vue&type=style&index=0&id=ebbd7a48&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1638493437462\n      var cssReload = require(\"D:/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}